---
title: "Untitled"
output: html_document
date: "2025-04-27"
---
```{r }
data <- read.csv("wisconsin_breast_cancer.csv")
head(data)
```

Задание 1.
Создайте регрессионную модель (или несколько моделей), которая описывала бы связь:
- среднего радиуса опухоли и средней площади;
- среднего периметра;
- средней симметричности.
Постройте график (или графики, если моделей несколько), на котором отразите регрессионную прямую, и прокомментируйте свои находки.

```{r}

# Удаляем столбец "X" он содержит только NA значения.
data <- data[, !names(data) %in% c("X")]
# проверяем
str(data)
```
Создаю модели линейной регресии для 3х вариантов 
```{r}
# Средний радиус от средней площади
model1 <- lm(radius_mean ~ area_mean, data = data)
summary(model1)
```
```{r}
#Средний радиус от среднего периметра
model2 <- lm(radius_mean ~ perimeter_mean, data = data)
summary(model2)
```

```{r}
#Средний радиус от средней симметричности
model3 <- lm(radius_mean ~ symmetry_mean, data = data)
summary(model3) 
```
Строю графили по каждой паре признаков
```{r}
par(mfrow = c(1, 3))
# Средний радиус от средней площади - model1
plot(data$area_mean, data$radius_mean,
     xlab = "Средняя площадь", ylab = "Средний радиус",
     main = "model1")
abline(model1, col = "red") 
mtext("Регрессионные модели для среднего радиуса опухоли", outer = TRUE, cex = 1.5) 

#Средний радиус от среднего периметра - model2
plot(data$perimeter_mean, data$radius_mean,
     xlab = "Средний периметр", ylab = "Средний радиус",
     main = "model2")
abline(model2, col = "blue") 

#Средний радиус от средней симметричности - model3
plot(data$symmetry_mean, data$radius_mean,
     xlab = "Средняя симметричность", ylab = "Средний радиус",
     main = "model3")
abline(model3, col = "green")

```
ВЫВОДЫ: 
1. МОдель 1 и модель 2 показывают что связь между признаками очень сильна т.т R2 97% и 99% соответственно, а вот Модель 3 имееет слабую связь т.к R2- 2% - также на графиках мы видим что первые 2 модели имеют не только сильную, но и линейную взаимосвязь, а последний график не имеет линойго распределения признаков.
2. Если оценивать  p-value у всех 3х моделей, то видно что все они по этому значению имеют  высокую статистическую значимость связи между переменными (даже в модели 3, несмотря на низкий R-квадрат, связь всё равно статистически значима)
3. Наименьшая стандартная ошибка - самый маленьки позатель у Модели 2(0.2309), что еще раз говорит о ее наилучшей точности по сравнению с 1 и 3 (значения ошибки -0.5591 и 3.488 соответственно)
Получается что наилучшим предиктором для среднего радиуса является - средний периметр, на втором месте средняя прощадь(предположительно снижение эффективности происходит из-за "хвостов" на графике т.е выбросами), и прям плохо показательные данные средней семметричности.

Задание 2
Пусть колонка с диагнозом принимает следующие значения: злокачественная опухоль (M) — 1, а доброкачественная (B) — 0. Постройте модель (или несколько моделей), которая прогнозировала бы вероятность возникновения злокачественной опухоли:
- от среднего радиуса;
- средней площади;
- средней текстуры.
Постройте графики. Создайте модель, которая бы прогнозировала вероятность возникновения злокачественной опухоли от всех трех перечисленных факторов.
```{r}
# Преобразуем столбец "diagnosis" в числовой формат и сразу проверяем что  формат изменился на num
data$diagnosis <- ifelse(data$diagnosis == "M", 1, 0)
str(data)
```
Создаю логистические регрессионные модели (прогнозирую вероятность) сначала для каждого признака отдельно
```{r}
# Модель 1: диагноз м средний радиус
model_radius_mean <- glm(diagnosis ~ radius_mean, data = data, family = "binomial")
summary(model_radius_mean)
```
```{r}
# Модель 2: диагнрз и средняя площадь 
model_area_mean <- glm(diagnosis ~ area_mean, data = data, family = "binomial")
summary(model_area_mean) 
```
```{r}
# Модель 3: диагноз и средняя текстура
model_texture_mean <- glm(diagnosis ~ texture_mean, data = data, family = "binomial")
summary(model_texture_mean) 
```
Далее создаю для всех показателей единую модель
```{r}
#vМодель 4: (все три фактора)
model_all <- glm(diagnosis ~ radius_mean + area_mean + texture_mean, data = data, family = "binomial")
summary(model_all) 
```
Визуализация
```{r}
plot_logistic_regression <- function(model, predictor, x_label, main_title) {
  # Создаем последовательность значений предиктора для построения кривой
  x_values <- seq(min(data[[predictor]]), max(data[[predictor]]), length.out = 100)

  # Создаем датафрейм для предсказания
  new_data <- data.frame(predictor_value = x_values)
  colnames(new_data) <- predictor 

  # Предсказываем вероятности для этих значений
  predicted_probabilities <- predict(model, newdata = new_data, type = "response")

  # Строим график
  plot(data[[predictor]], data$diagnosis,
       xlab = x_label, ylab = "Вероятность злокачественной опухоли",
       main = main_title,
       pch = 16, col = "darkgray") 
  lines(x_values, predicted_probabilities, col = "green", lwd = 2) 
}

par(mfrow = c(1, 3))

# График 1: диагноз и средний радиус
plot_logistic_regression(model_radius_mean, "radius_mean", "Средний радиус", "Вероятность и Радиус")

# График 2: диагноз и средняя площадь
plot_logistic_regression(model_area_mean, "area_mean", "Средняя площадь", "Вероятность и Площадь")

# График 3: диагноз и средняя текстура
plot_logistic_regression(model_texture_mean, "texture_mean", "Средняя текстура", "Вероятность и Текстура")

```
ВЫВОДЫ: по отдельным моделям:
1. Считается статистически значимым результатом. больший средний радиус опухоли связан с большей вероятностью злокачественной опухоли. AIC: 334.01.
2.  Считается статистически значимым результатом. большая средняя площадь опухоли связана с большей вероятностью злокачественной опухоли. AIC: 329,66
3. Считается статистически значимым результатом. Большая средняя текстура опухоли связана с большей вероятностью злокачественной опухоли.AIC: 650.52
4. НО при просмотре общей модели результаты меняются: 
AIC: 296,81 - этот показатель меньше всего по сравнению с остальными моделями, это говорит о том что именно 4тая общая модель описывает взаимосвязи лучше всего.  И только средняя текстура опухоли остается статистически значимым предиктором злокачественности имея p-value 1.78e-08. Все это говорит о том, что важно учитывать взаимосвязь между факторами

ЗАДАНИЕ 3.
Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0,8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1 = p2 = 0,5). 
```{r}
# Расчет размера выборки для исследования с регрессией Кокса
# Параметры исследования
HR <- 2         
alpha <- 0.05  
d <- 0.8 
p1 <- 0.5  
p2 <- 0.5       

Z <- qnorm(1 - alpha/2)

n <- ((Z/2 + Z)^2) / ((log(HR))^2 * p1 * p2 * d)
#формула для расчета на сайте была предоставлена не правильная, заменила исходное умножение на правильное деление в формуле

n1 <- ceiling(n)
total_n <- 2 * n1  

cat("Необходимый размер одной группы:", n1, "\n")
cat("Общий необходимый размер выборки:", total_n, "\n")

```

```


